<!doctype html>
<html lang="en">
<head>
  <title>JPG to PDF Converter - Free Online Tool | SmartToolVerse</title>
<meta name="description" content="Convert JPG or PNG images to a single high-quality PDF instantly. 100% free and secure image to PDF converter.">
<meta name="keywords" content="jpg to pdf, image to pdf, convert jpg, online pdf maker, free converter tool">
  <!-- Basic meta / SEO -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>JPG to PDF Converter — Convert Images to PDF</title>
  <meta name="description" content="Convert JPG, PNG, WEBP images to a single PDF file in the browser. Reorder images, set page size/orientation, margins, and metadata.">
  <meta name="keywords" content="jpg to pdf, image to pdf, convert images, client-side pdf, jsPDF">
  <link rel="icon" href="data:;base64,iVBORw0KGgo="> <!-- placeholder favicon -->

  <!-- Google Fonts (optional) -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <!-- External libs (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    /* ---------- Reset & Base ---------- */
    :root{
      --bg:#f6f8fa; --card:#fff; --muted:#6b7280; --accent:#6d28d9; --glass:rgba(255,255,255,0.6);
      --shadow: 0 6px 20px rgba(16,24,40,0.08);
      --radius:14px;
    }
    [data-theme='dark']{ --bg:#0b1020; --card:#0f1724; --muted:#9ca3af; --accent:#7c3aed; --glass:rgba(255,255,255,0.04); --shadow: 0 8px 30px rgba(2,6,23,0.7); }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial;color:var(--text,#0f1724);background:linear-gradient(180deg,var(--bg),#e9eef9);}
    [data-theme='dark'] body{color:#e6eef8;background:linear-gradient(180deg,var(--bg),#071029);} 

    /* ---------- Layout ---------- */
    header{display:flex;align-items:center;justify-content:space-between;padding:20px 24px;gap:12px}
    .logo{display:flex;align-items:center;gap:12px}
    .logo .mark{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#06b6d4);box-shadow:var(--shadow);display:flex;align-items:center;justify-content:center;color:white;font-weight:700}
    nav a{margin-left:14px;color:var(--muted);text-decoration:none;font-weight:600}
    nav a:hover{color:var(--accent)}

    .container{max-width:1100px;margin:24px auto;padding:16px}
    .grid{display:grid;grid-template-columns:1fr 420px;gap:20px}
    @media (max-width:980px){.grid{grid-template-columns:1fr} .right-col{order:2}}

    /* ---------- Cards ---------- */
    .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px}
    .hero{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:22px}
    .hero .title{font-size:1.15rem;font-weight:700}
    .hero p{margin:4px 0 0;color:var(--muted);font-size:0.95rem}

    /* ---------- Upload area ---------- */
    .upload-area{border:2px dashed rgba(99,102,241,0.18);border-radius:12px;padding:18px;display:flex;flex-direction:column;gap:12px;align-items:center;justify-content:center;min-height:180px}
    .upload-area.dragover{background:linear-gradient(0deg,rgba(99,102,241,0.04),transparent);border-color:var(--accent)}
    .upload-actions{display:flex;gap:10px;align-items:center}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;background:linear-gradient(90deg,var(--accent),#0ea5a4);color:white;border:none;cursor:pointer;box-shadow:var(--shadow);font-weight:600}
    .btn.ghost{background:transparent;color:var(--muted);border:1px solid rgba(0,0,0,0.06)}
    .btn:active{transform:translateY(1px)}

    /* ---------- Thumbnails list ---------- */
    .thumbs{display:flex;flex-direction:column;gap:10px;margin-top:12px}
    .thumb{display:flex;gap:12px;align-items:center;padding:10px;border-radius:10px;background:linear-gradient(180deg,var(--glass),transparent);border:1px solid rgba(0,0,0,0.03)}
    .thumb img{width:72px;height:54px;object-fit:cover;border-radius:8px}
    .thumb .meta{flex:1}
    .thumb .meta .name{font-weight:600}
    .thumb .meta .size{font-size:0.85rem;color:var(--muted)}
    .thumb .controls{display:flex;gap:6px}
    .icon-btn{background:transparent;border:1px solid rgba(0,0,0,0.06);padding:8px;border-radius:8px;cursor:pointer}

    /* ---------- Options & Controls ---------- */
    .option-row{display:flex;gap:12px;flex-wrap:wrap;margin:10px 0}
    .field{display:flex;flex-direction:column;min-width:140px}
    label{font-size:0.85rem;margin-bottom:6px;color:var(--muted)}
    select,input[type='number'],input[type='text']{padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.08);background:transparent}

    /* ---------- Footer ---------- */
    footer{margin-top:20px;padding:18px;text-align:center;color:var(--muted)}

    /* ---------- Small helpers ---------- */
    .muted{color:var(--muted)}
    .progress{height:8px;background:rgba(0,0,0,0.06);border-radius:999px;overflow:hidden}
    .progress > i{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),#06b6d4)}

    /* ---------- Animations ---------- */
    .fade-up{animation:fadeUp .42s ease both}
    @keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}

    /* Accessibility focus */
    .btn:focus,.icon-btn:focus,input:focus,select:focus{outline:3px solid rgba(99,102,241,0.18);outline-offset:2px}
  </style>
</head>
<body data-theme="light">
  <!-- HEADER -->
  <header class="container">
    <div class="logo">
      <div class="mark" aria-hidden="true">JP</div>
      <div>
        <div style="font-weight:700">JPG to PDF</div>
        <div style="font-size:12px;color:var(--muted)">Fast & private — in your browser</div>
      </div>
    </div>
    <nav aria-label="Main Navigation">
      <a href="#home">Home</a>
      <a href="#more-tools">More Tools</a>
      <button id="themeToggle" class="btn" aria-pressed="false" title="Toggle dark mode">Toggle</button>
    </nav>
  </header>

  <!-- MAIN CONTENT -->
  <main class="container">
    <section class="grid">
      <!-- LEFT COLUMN: Tool -->
      <div class="left-col">
        <div class="card hero">
          <div>
            <div class="title">Convert your images to a single PDF</div>
            <p>Upload JPG, PNG, or WEBP images — reorder pages, set paper size, orientation, margins, and download a compact PDF.</p>
          </div>
          <div style="min-width:160px;text-align:right">
            <div class="muted" style="font-size:12px">No uploads sent to server</div>
            <div class="muted" style="font-size:12px">Client-side conversion</div>
          </div>
        </div>

        <div class="card" style="margin-top:18px">
          <label for="fileInput" class="muted">Select images</label>
          <div id="dropArea" class="upload-area" tabindex="0" role="button" aria-label="Drop images here or click to select">
            <div style="text-align:center">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" aria-hidden>
                <path d="M12 16V4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M8 8l4-4 4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <rect x="3" y="16" width="18" height="4" rx="1" stroke="currentColor" stroke-width="1.2"/>
              </svg>
              <div style="font-weight:700;margin-top:8px">Drop images here</div>
              <div class="muted" style="font-size:13px">or click to browse — JPG, JPEG, PNG, WEBP</div>
            </div>
            <div class="upload-actions" style="margin-top:10px">
              <input id="fileInput" type="file" accept="image/*" multiple style="display:none" aria-hidden="true">
              <button id="browseBtn" class="btn" aria-label="Browse files">Choose Files</button>
              <button id="clearBtn" class="btn ghost" aria-label="Clear all">Clear All</button>
            </div>
          </div>

          <div id="thumbs" class="thumbs" aria-live="polite" style="margin-top:12px"></div>
        </div>

        <!-- ACTIONS -->
        <div class="card" style="margin-top:18px;display:flex;flex-direction:column;gap:12px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div style="font-weight:700">PDF Options</div>
            <div class="muted">Set page size, orientation & image fit</div>
          </div>

          <div class="option-row">
            <div class="field">
              <label for="pageSize">Page size</label>
              <select id="pageSize" aria-label="Select page size">
                <option value="a4">A4 (210 × 297 mm)</option>
                <option value="letter">Letter (8.5 × 11 in)</option>
              </select>
            </div>

            <div class="field">
              <label for="orientation">Orientation</label>
              <select id="orientation" aria-label="Select orientation">
                <option value="portrait">Portrait</option>
                <option value="landscape">Landscape</option>
              </select>
            </div>

            <div class="field">
              <label for="margin">Margin (mm)</label>
              <input id="margin" type="number" min="0" max="50" value="10" aria-label="PDF margin in millimeters">
            </div>

            <div class="field">
              <label for="fitMode">Image fit</label>
              <select id="fitMode" aria-label="Select image fit">
                <option value="contain">Contain (fit inside)</option>
                <option value="cover">Cover (crop to fill)</option>
              </select>
            </div>
          </div>

          <details>
            <summary style="cursor:pointer;font-weight:600">Advanced: PDF metadata</summary>
            <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap">
              <input id="metaTitle" type="text" placeholder="Title" aria-label="PDF title" style="flex:1">
              <input id="metaAuthor" type="text" placeholder="Author" aria-label="PDF author" style="flex:1">
            </div>
          </details>

          <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
            <button id="generateBtn" class="btn" aria-label="Generate PDF">Generate PDF</button>
            <div style="flex:1">
              <div class="progress" aria-hidden="true"><i id="progressBar" style="width:0%"></i></div>
              <div id="statusText" class="muted" style="font-size:13px;margin-top:6px">Ready</div>
            </div>
            <a id="downloadLink" class="btn ghost" style="display:none" download>Download PDF</a>
          </div>
        </div>
      </div>

      <!-- RIGHT COLUMN: Preview & Info -->
      <aside class="right-col">
        <div class="card">
          <div style="font-weight:700">Preview & Controls</div>
          <p class="muted" style="margin-top:6px">Drag image thumbnails to reorder pages. Use move buttons for keyboard users.</p>

          <div style="margin-top:12px">
            <div style="display:flex;gap:8px;margin-bottom:8px">
              <button id="moveUp" class="btn ghost" title="Move selected up">Move Up</button>
              <button id="moveDown" class="btn ghost" title="Move selected down">Move Down</button>
              <button id="selectAll" class="btn ghost" title="Select all thumbnails">Select All</button>
            </div>

            <div style="margin-top:6px">
              <div style="font-weight:600">Estimated PDF pages:</div>
              <div id="count" class="muted">0 images</div>
            </div>
          </div>
        </div>

        <div class="card" style="margin-top:14px">
          <div style="font-weight:700">Tips</div>
          <ul style="margin-top:8px;color:var(--muted);padding-left:18px">
            <li>Images are processed client-side for privacy.</li>
            <li>Use cover for full-bleed pages, contain to keep whole image visible.</li>
            <li>Smaller margins reduce whitespace and PDF size.</li>
          </ul>
        </div>

      </aside>
    </section>

    <!-- FOOTER -->
    <footer>
      <div class="muted">© <span id="yr"></span> JPG to PDF • All rights reserved • <a href="#more-tools">More Tools</a></div>
      <div style="margin-top:8px">
        <a href="#" aria-label="Twitter" class="muted">Twitter</a> &nbsp;•&nbsp;
        <a href="#" aria-label="GitHub" class="muted">GitHub</a> &nbsp;•&nbsp;
        <a href="#" aria-label="Contact" class="muted">Contact</a>
      </div>
    </footer>
  </main>


  <!-- SCRIPTS -->
  <script>
    // ---------- Utilities ----------
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    const fileInput = $('#fileInput');
    const browseBtn = $('#browseBtn');
    const dropArea = $('#dropArea');
    const thumbs = $('#thumbs');
    const clearBtn = $('#clearBtn');
    const generateBtn = $('#generateBtn');
    const progressBar = $('#progressBar');
    const statusText = $('#statusText');
    const downloadLink = $('#downloadLink');
    const pageSize = $('#pageSize');
    const orientation = $('#orientation');
    const marginInput = $('#margin');
    const fitMode = $('#fitMode');
    const metaTitle = $('#metaTitle');
    const metaAuthor = $('#metaAuthor');
    const themeToggle = $('#themeToggle');
    const moveUp = $('#moveUp');
    const moveDown = $('#moveDown');
    const selectAll = $('#selectAll');
    const countEl = $('#count');
    const yr = $('#yr');
    yr.textContent = new Date().getFullYear();

    // store files as {file, url, name, size, id}
    let images = [];
    let selectedId = null;

    // Acceptable mime types
    const ACCEPT = ['image/jpeg','image/png','image/webp'];

    // Setup Sortable for drag-and-drop ordering
    const sortable = new Sortable(thumbs, {
      animation:150,
      handle:'.thumb',
      onEnd:e=>{
        // reorder images array to match DOM
        const ids = Array.from(thumbs.children).map(ch => ch.dataset.id);
        images = ids.map(id => images.find(i=>i.id===id));
        updateCount();
      }
    });

    // Helpers
    function bytesToSize(bytes){ if(bytes===0) return '0 B'; const k=1024; const sizes=['B','KB','MB','GB']; const i=Math.floor(Math.log(bytes)/Math.log(k)); return parseFloat((bytes/Math.pow(k,i)).toFixed(2))+' '+sizes[i]; }
    function uid(){ return 'id'+Math.random().toString(36).slice(2,9); }

    // Handle files
    function handleFiles(fileList){
      const arr = Array.from(fileList);
      let added=false;
      arr.forEach(f=>{
        if(!ACCEPT.includes(f.type)) return; // skip unsupported
        const id = uid();
        const url = URL.createObjectURL(f);
        images.push({file:f,url,name:f.name,size:f.size,id});
        added=true;
      });
      if(!added){ showStatus('No supported image files found.', true); }
      renderThumbs();
    }

    // Render thumbnails
    function renderThumbs(){
      thumbs.innerHTML='';
      images.forEach(img=>{
        const div = document.createElement('div');
        div.className='thumb fade-up';
        div.tabIndex=0;
        div.dataset.id = img.id;
        div.setAttribute('role','listitem');
        div.innerHTML = `
          <img src="${img.url}" alt="${escapeHtml(img.name)}" />
          <div class="meta">
            <div class="name">${escapeHtml(img.name)}</div>
            <div class="size">${bytesToSize(img.size)}</div>
          </div>
          <div class="controls">
            <button class="icon-btn" data-action="select" title="Select" aria-label="Select">🔘</button>
            <button class="icon-btn" data-action="remove" title="Remove" aria-label="Remove">✖</button>
          </div>
        `;
        // click handlers
        div.querySelector('[data-action="select"]').addEventListener('click', ()=>{ selectThumb(img.id); });
        div.querySelector('[data-action="remove"]').addEventListener('click', ()=>{ removeImage(img.id); });
        div.addEventListener('click', (e)=>{ if(e.target.dataset && e.target.dataset.action) return; selectThumb(img.id); });
        div.addEventListener('keydown', (e)=>{ if(e.key==='Enter') selectThumb(img.id); });
        thumbs.appendChild(div);
      });
      updateCount();
    }

    function selectThumb(id){ selectedId = id; Array.from(thumbs.children).forEach(ch=>{ ch.style.outline = (ch.dataset.id===id)?'2px solid rgba(99,102,241,0.22)':'none'; }); }

    function removeImage(id){ const idx = images.findIndex(i=>i.id===id); if(idx>-1){ URL.revokeObjectURL(images[idx].url); images.splice(idx,1); if(selectedId===id) selectedId=null; renderThumbs(); } }

    function clearAll(){ images.forEach(i=>URL.revokeObjectURL(i.url)); images=[]; selectedId=null; renderThumbs(); downloadLink.style.display='none'; resetProgress(); }

    // Move selected up / down for keyboard users
    function moveSelected(offset){ if(!selectedId || images.length<2) return; const idx = images.findIndex(i=>i.id===selectedId); if(idx===-1) return; const newIdx = Math.min(Math.max(0, idx+offset), images.length-1); const [item] = images.splice(idx,1); images.splice(newIdx,0,item); renderThumbs(); selectThumb(item.id); }

    // Accessibility: escape HTML in names
    function escapeHtml(s){ return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    // Status helpers
    function showStatus(msg, isError=false){ statusText.textContent = msg; if(isError){ statusText.style.color='tomato'; } else { statusText.style.color=''; } }
    function resetProgress(){ progressBar.style.width='0%'; showStatus('Ready'); }

    function updateCount(){ countEl.textContent = images.length + (images.length===1? ' image':' images'); }

    // Drag & drop ui
    ;['dragenter','dragover'].forEach(ev=>{ dropArea.addEventListener(ev,e=>{ e.preventDefault(); dropArea.classList.add('dragover'); }, false); });
    ;['dragleave','drop'].forEach(ev=>{ dropArea.addEventListener(ev,e=>{ e.preventDefault(); dropArea.classList.remove('dragover'); }, false); });
    dropArea.addEventListener('drop', e=>{ const dt = e.dataTransfer; if(dt && dt.files) handleFiles(dt.files); });
    browseBtn.addEventListener('click', ()=>fileInput.click());
    dropArea.addEventListener('click', ()=>fileInput.click());
    fileInput.addEventListener('change', e=>{ handleFiles(e.target.files); fileInput.value=''; });

    clearBtn.addEventListener('click', ()=>{ if(confirm('Clear all uploaded images?')) clearAll(); });

    moveUp.addEventListener('click', ()=>moveSelected(-1));
    moveDown.addEventListener('click', ()=>moveSelected(1));
    selectAll.addEventListener('click', ()=>{ if(images.length) selectThumb(images[0].id); });

    // Theme toggle
    function setTheme(t){ document.body.setAttribute('data-theme', t); themeToggle.setAttribute('aria-pressed', t==='dark'); themeToggle.textContent = (t==='dark')? 'Light':'Dark'; }
    themeToggle.addEventListener('click', ()=>{ const cur = document.body.getAttribute('data-theme'); setTheme(cur==='dark'?'light':'dark'); });

    // --------- PDF Generation Logic ----------
    async function generatePDF(){
      if(images.length===0){ showStatus('No images selected — add images first.', true); return; }
      generateBtn.disabled=true; showStatus('Preparing images...');
      progressBar.style.width='2%';

      // page sizes in mm -> jsPDF uses pt or mm. We'll use mm
      const sizes = {
        a4: {w:210,h:297},
        letter: {w:216,h:279}
      };
      const selectedSize = pageSize.value;
      const orient = orientation.value;
      const margin = parseFloat(marginInput.value) || 10;
      const fit = fitMode.value;

      const docInfo = { title: metaTitle.value||'', author: metaAuthor.value||'' };

      // Create jsPDF instance
      const { jsPDF } = window.jspdf;
      const s = sizes[selectedSize];
      const pdf = new jsPDF({ unit:'mm', format:[s.w, s.h], orientation: orient });

      // Set metadata if provided
      if(docInfo.title) pdf.setProperties({title:docInfo.title, subject:docInfo.title});
      if(docInfo.author) pdf.setProperties({author:docInfo.author});

      // iterate images and add to PDF
      for(let i=0;i<images.length;i++){
        const img = images[i];
        showStatus(`Processing ${i+1} of ${images.length}: ${img.name}`);
        const pct = Math.round((i / images.length)*90) + 5;
        progressBar.style.width = pct + '%';

        try{
          const imgData = await loadAndPrepareImage(img.file, s, orient, margin, fit);
          const {dataUrl, drawW, drawH, x, y} = imgData;
          // add page except first
          if(i>0) pdf.addPage([s.w,s.h], orient);
          pdf.setPage(i+1);
          // draw image as JPG/PNG (jsPDF will compress automatically)
          pdf.addImage(dataUrl, 'JPEG', x, y, drawW, drawH, undefined, 'FAST');
        }catch(err){
          console.error('Image processing error',err);
          showStatus('Error processing image: '+img.name, true);
        }
      }

      progressBar.style.width='98%';
      showStatus('Finalizing PDF...');

      // Output PDF blob
      const blob = pdf.output('blob');
      const ts = new Date();
      const fname = `converted-${pad(ts.getFullYear(),4)}${pad(ts.getMonth()+1)}${pad(ts.getDate())}-${pad(ts.getHours())}${pad(ts.getMinutes())}${pad(ts.getSeconds())}.pdf`;
      const url = URL.createObjectURL(blob);

      downloadLink.href = url;
      downloadLink.download = fname;
      downloadLink.style.display = 'inline-flex';
      downloadLink.textContent = 'Download PDF';

      progressBar.style.width='100%';
      showStatus('PDF ready — click Download or it will start automatically.');
      // Auto-click download
      setTimeout(()=>downloadLink.click(), 300);

      generateBtn.disabled=false;
    }

    // small pad fn for filename
    function pad(n, len=2){ return String(n).padStart(len,'0'); }

    // Load image, draw to canvas to control resolution/fit, return dataURL and placement
    async function loadAndPrepareImage(file, pageSizeMM, orient, marginMM, fitMode){
      return new Promise((resolve, reject)=>{
        const img = new Image();
        img.onload = ()=>{
          try{
            // convert page size from mm to px at 150 dpi for canvas computations
            const DPI = 150; // moderate quality; keeps PDF size reasonable
            const mmToIn = mm => mm/25.4;
            const pageWpx = Math.round(mmToIn(pageSizeMM.w) * DPI);
            const pageHpx = Math.round(mmToIn(pageSizeMM.h) * DPI);
            const marginPx = Math.round(mmToIn(marginMM) * DPI);

            let targetW = pageWpx - marginPx*2;
            let targetH = pageHpx - marginPx*2;

            // If landscape swap
            if(orient==='landscape'){ [targetW,targetH] = [targetH,targetW]; }

            // compute draw size depending on fitMode
            let drawW = img.width, drawH = img.height;
            const imgRatio = img.width / img.height;
            const pageRatio = targetW / targetH;

            if(fitMode==='contain'){
              if(imgRatio > pageRatio){ // image wider
                drawW = targetW; drawH = Math.round(targetW / imgRatio);
              } else { drawH = targetH; drawW = Math.round(targetH * imgRatio); }
            } else { // cover
              if(imgRatio > pageRatio){ // image wider -> cover height
                drawH = targetH; drawW = Math.round(targetH * imgRatio);
              } else { drawW = targetW; drawH = Math.round(targetW / imgRatio); }
            }

            // place center
            const x = (pageWpx - drawW) / 2;
            const y = (pageHpx - drawH) / 2;

            // create canvas for image resizing
            const canvas = document.createElement('canvas');
            canvas.width = pageWpx;
            canvas.height = pageHpx;
            const ctx = canvas.getContext('2d');
            // fill white background
            ctx.fillStyle = '#ffffff'; ctx.fillRect(0,0,canvas.width,canvas.height);
            // draw image
            ctx.drawImage(img, x, y, drawW, drawH);

            // produce JPEG dataURL with quality tuned
            const dataUrl = canvas.toDataURL('image/jpeg', 0.85);

            // convert px back to mm for jsPDF placement
            const pxToMm = px => px / DPI * 25.4;
            const drawWmm = pxToMm(drawW);
            const drawHmm = pxToMm(drawH);
            const xmm = pxToMm(x);
            const ymm = pxToMm(y);

            resolve({dataUrl, drawW: drawWmm, drawH: drawHmm, x: xmm, y: ymm});
          }catch(err){ reject(err); }
        };
        img.onerror = e=>reject(new Error('Could not load image'));
        img.src = URL.createObjectURL(file);
      });
    }

    // Button hooks
    generateBtn.addEventListener('click', async ()=>{
      try{ await generatePDF(); }catch(e){ console.error(e); showStatus('Unexpected error creating PDF', true); generateBtn.disabled=false; }
    });

    // Download link: revoke URL after download
    downloadLink.addEventListener('click', ()=>{ setTimeout(()=>{ try{ URL.revokeObjectURL(downloadLink.href); }catch(e){} }, 2000); });

    // Simple validation when adding files
    function validateAndAdd(files){ const ok = Array.from(files).some(f=>ACCEPT.includes(f.type)); if(!ok){ showStatus('Please upload JPG, PNG, or WEBP images only.', true); return; } handleFiles(files); }

    // Keyboard accessibility for dropArea
    dropArea.addEventListener('keydown', e=>{ if(e.key==='Enter' || e.key===' ') fileInput.click(); });

    // ensure file input drag drop on mobile
    ['touchstart','touchend'].forEach(ev=>dropArea.addEventListener(ev, ()=>{}, {passive:true}));

    // small init: wire fileInput to validation wrapper
    fileInput.addEventListener('change', (e)=>{ validateAndAdd(e.target.files); });

    // set initial theme from prefers-color-scheme
    (function(){ const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches; setTheme(prefersDark?'dark':'light'); })();

    // small helper to show user-friendly errors when unsupported files are dragged
    dropArea.addEventListener('dragover', (e)=>{ const types = e.dataTransfer.types; /* no-op: placeholder */ }, false);

    // fallback: when user drags non-image, show message on drop
    dropArea.addEventListener('drop', (e)=>{
      const dt = e.dataTransfer;
      if(dt && dt.files && dt.files.length){ const invalid = Array.from(dt.files).every(f=>!ACCEPT.includes(f.type)); if(invalid){ showStatus('Unsupported file(s). Please upload JPG/PNG/WEBP images only.', true); } }
    });

    // Utility: prevent accidental navigation
    window.addEventListener('beforeunload', function (e) {
      if(images.length>0) {
        e.preventDefault();
        e.returnValue = '';
      }
    });

    // Prevent generating extremely large PDFs by limiting canvas DPI for very large images
    // (Handled implicitly by using fixed DPI in loadAndPrepareImage.)

    // tiny UI polish: select first thumb when clicked area
    thumbs.addEventListener('click', (e)=>{
      const t = e.target.closest('.thumb'); if(t) selectThumb(t.dataset.id);
    });

    // Provide keyboard shortcuts
    window.addEventListener('keydown', (e)=>{
      if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='g'){ e.preventDefault(); generateBtn.click(); }
      if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='k'){ e.preventDefault(); fileInput.click(); }
    });

  </script>

</body>
</html>
